<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voluntry API Documentation</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 { font-size: 2.5em; margin-bottom: 10px; }
    .header p { opacity: 0.9; }
    .content { padding: 30px; }
    .token-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      border-left: 4px solid #667eea;
    }
    .token-section input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      margin-top: 10px;
    }
    .endpoint-group {
      margin-bottom: 40px;
    }
    .endpoint-group h2 {
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #667eea;
    }
    .endpoint {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #e0e0e0;
    }
    .endpoint-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    .method {
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 12px;
      text-transform: uppercase;
    }
    .method.get { background: #61affe; color: white; }
    .method.post { background: #49cc90; color: white; }
    .method.put { background: #fca130; color: white; }
    .method.delete { background: #f93e3e; color: white; }
    .path {
      font-family: 'Courier New', monospace;
      font-size: 16px;
      color: #333;
      font-weight: 600;
    }
    .description {
      color: #666;
      margin-bottom: 15px;
    }
    .auth-badge {
      display: inline-block;
      background: #ffc107;
      color: #333;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 10px;
    }
    .input-group {
      display: grid;
      gap: 10px;
      margin-bottom: 15px;
    }
    .input-group input {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    .test-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
    }
    .test-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: background 0.3s;
    }
    .test-btn:hover { background: #5568d3; }
    .response {
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      border-left: 4px solid #667eea;
      display: none;
    }
    .response.show { 
      display: block;
      animation: slideDown 0.3s ease-out;
    }
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .response pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
    }
    .response.success { border-left-color: #49cc90; }
    .response.error { border-left-color: #f93e3e; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸš€ Voluntry API Documentation</h1>
      <p>Test all endpoints directly from this page</p>
    </div>
    <div class="content">
      <div class="token-section">
        <h3>ðŸ”‘ Authentication Token</h3>
        <p>After logging in, your JWT token will be auto-filled here:</p>
        <input type="text" id="authToken" placeholder="Bearer token will be auto-filled after login">
      </div>

      <!-- Health Check -->
      <div class="endpoint-group">
        <h2>Health Check</h2>
        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method get">GET</span>
            <span class="path">/health</span>
          </div>
          <div class="description">Health check endpoint - no authentication required</div>
          <div class="test-section">
            <button class="test-btn" onclick="testEndpoint('GET', '/health', null)">Test</button>
            <div class="response" id="response-health"></div>
          </div>
        </div>
      </div>

      <!-- Authentication -->
      <div class="endpoint-group">
        <h2>Authentication</h2>
        
        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method post">POST</span>
            <span class="path">/api/auth/register</span>
          </div>
          <div class="description">Register a new user account</div>
          <div class="test-section">
            <div class="input-group">
              <input type="text" id="register-name" placeholder="Name *" value="John Doe">
              <input type="email" id="register-email" placeholder="Email *" value="john@example.com">
              <input type="password" id="register-password" placeholder="Password *" value="password123">
            </div>
            <button class="test-btn" onclick="testRegister()">Test Register</button>
            <div class="response" id="response-register"></div>
          </div>
        </div>

        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method post">POST</span>
            <span class="path">/api/auth/login</span>
          </div>
          <div class="description">Login and get JWT token</div>
          <div class="test-section">
            <div class="input-group">
              <input type="email" id="login-email" placeholder="Email *" value="john@example.com">
              <input type="password" id="login-password" placeholder="Password *" value="password123">
            </div>
            <button class="test-btn" onclick="testLogin()">Test Login</button>
            <div class="response" id="response-login"></div>
          </div>
        </div>

        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method post">POST</span>
            <span class="path">/api/auth/refresh</span>
          </div>
          <div class="description">Refresh access token using refresh token</div>
          <div class="test-section">
            <div class="input-group">
              <input type="text" id="refresh-token" placeholder="Refresh Token *">
            </div>
            <button class="test-btn" onclick="testRefresh()">Test Refresh</button>
            <div class="response" id="response-refresh"></div>
          </div>
        </div>

        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method post">POST</span>
            <span class="path">/api/auth/logout</span>
            <span class="auth-badge">Auth Required</span>
          </div>
          <div class="description">Logout user (invalidates refresh token)</div>
          <div class="test-section">
            <button class="test-btn" onclick="testEndpoint('POST', '/api/auth/logout', null, true)">Test Logout</button>
            <div class="response" id="response-logout"></div>
          </div>
        </div>
      </div>

      <!-- Chat APIs -->
      <div class="endpoint-group">
        <h2>Chat APIs</h2>
        
        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method post">POST</span>
            <span class="path">/api/chat</span>
            <span class="auth-badge">Auth Required</span>
          </div>
          <div class="description">Send a message to AI chat and get response. Conversation history is automatically maintained.</div>
          <div class="test-section">
            <div class="input-group">
              <input type="text" id="chat-content" placeholder="Your message *" value="How can I help with volunteering?">
              <input type="text" id="chat-conversation-id" placeholder="Conversation ID (optional - leave empty for new conversation)">
            </div>
            <button class="test-btn" onclick="testChatSend()">Send Message</button>
            <div class="response" id="response-chat"></div>
          </div>
        </div>

        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method get">GET</span>
            <span class="path">/api/chat/history</span>
            <span class="auth-badge">Auth Required</span>
          </div>
          <div class="description">Get chat history. Optionally filter by conversation ID.</div>
          <div class="test-section">
            <div class="input-group">
              <input type="text" id="history-conversation-id" placeholder="Conversation ID (optional - leave empty for all messages)">
              <input type="number" id="history-limit" placeholder="Limit (default: 50)" value="50">
            </div>
            <button class="test-btn" onclick="testChatHistory()">Get History</button>
            <div class="response" id="response-chat-history"></div>
          </div>
        </div>

        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method get">GET</span>
            <span class="path">/api/chat/conversations</span>
            <span class="auth-badge">Auth Required</span>
          </div>
          <div class="description">Get list of all conversations for the current user.</div>
          <div class="test-section">
            <div class="input-group">
              <input type="number" id="conversations-limit" placeholder="Limit (default: 20)" value="20">
            </div>
            <button class="test-btn" onclick="testChatConversations()">Get Conversations</button>
            <div class="response" id="response-chat-conversations"></div>
          </div>
        </div>

        <div class="endpoint">
          <div class="endpoint-header">
            <span class="method delete">DELETE</span>
            <span class="path">/api/chat/conversation/:conversationId</span>
            <span class="auth-badge">Auth Required</span>
          </div>
          <div class="description">Delete a specific conversation and all its messages.</div>
          <div class="test-section">
            <div class="input-group">
              <input type="text" id="delete-conversation-id" placeholder="Conversation ID *">
            </div>
            <button class="test-btn" onclick="testChatDelete()" style="background: #f93e3e;">Delete Conversation</button>
            <div class="response" id="response-chat-delete"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const baseUrl = 'BASE_URL_PLACEHOLDER';
    
    async function testEndpoint(method, endpoint, body, needsAuth = false) {
      // Map endpoints to response IDs
      const responseIdMap = {
        '/health': 'response-health',
        '/api/auth/register': 'response-register',
        '/api/auth/login': 'response-login',
        '/api/auth/refresh': 'response-refresh',
        '/api/auth/logout': 'response-logout',
        '/api/chat': 'response-chat',
        '/api/chat/history': 'response-chat-history',
        '/api/chat/conversations': 'response-chat-conversations',
      };
      
      // Extract base endpoint for ID mapping
      let baseEndpoint = endpoint.split('?')[0]; // Remove query params
      
      // Handle delete conversation endpoint
      if (baseEndpoint.startsWith('/api/chat/conversation/')) {
        baseEndpoint = '/api/chat/conversation';
      }
      
      let responseId = responseIdMap[baseEndpoint];
      
      // Fallback: generate ID from endpoint
      if (!responseId) {
        responseId = 'response-' + baseEndpoint.replace(/[^a-z0-9]/gi, '-').toLowerCase();
      }
      
      // Special handling for delete conversation
      if (endpoint.includes('/api/chat/conversation/') && method === 'DELETE') {
        responseId = 'response-chat-delete';
      }
      
      let responseDiv = document.getElementById(responseId);
      
      if (!responseDiv) {
        responseDiv = document.createElement('div');
        responseDiv.className = 'response';
        responseDiv.id = responseId;
        const testSection = event?.target?.closest('.test-section');
        if (testSection) {
          testSection.appendChild(responseDiv);
        } else {
          document.body.appendChild(responseDiv);
        }
      }
      
      responseDiv.className = 'response';
      responseDiv.innerHTML = '<pre>Loading...</pre>';
      responseDiv.classList.add('show');
      
      const options = {
        method: method,
        headers: {
          'Content-Type': 'application/json'
        }
      };

      if (needsAuth) {
        const token = document.getElementById('authToken').value;
        if (!token) {
          responseDiv.className = 'response error show';
          responseDiv.innerHTML = '<pre>Error: Please add authentication token first (login to get token)</pre>';
          return;
        }
        options.headers['Authorization'] = 'Bearer ' + token;
      }

      if (body && (method === 'POST' || method === 'PUT')) {
        options.body = JSON.stringify(body);
      }

      try {
        const response = await fetch(baseUrl + endpoint, options);
        const data = await response.json();
        
        responseDiv.className = 'response ' + (response.ok ? 'success' : 'error') + ' show';
        responseDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        
        // Auto-fill token if login/register successful
        if ((endpoint === '/api/auth/login' || endpoint === '/api/auth/register') && data.token) {
          document.getElementById('authToken').value = data.token;
          if (data.refreshToken) {
            document.getElementById('refresh-token').value = data.refreshToken;
          }
        }
      } catch (error) {
        responseDiv.className = 'response error show';
        responseDiv.innerHTML = '<pre>Error: ' + error.message + '</pre>';
      }
    }

    function testRegister() {
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      if (!name || !email || !password) {
        alert('Please fill in all fields');
        return;
      }
      testEndpoint('POST', '/api/auth/register', {name, email, password});
    }

    function testLogin() {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      if (!email || !password) {
        alert('Please fill in all fields');
        return;
      }
      testEndpoint('POST', '/api/auth/login', {email, password});
    }

    function testRefresh() {
      const refreshToken = document.getElementById('refresh-token').value;
      if (!refreshToken) {
        alert('Please provide refresh token');
        return;
      }
      testEndpoint('POST', '/api/auth/refresh', {refreshToken});
    }

    function testChatSend() {
      const content = document.getElementById('chat-content').value;
      const conversationId = document.getElementById('chat-conversation-id').value;
      if (!content) {
        alert('Please enter a message');
        return;
      }
      const body = { content };
      if (conversationId) {
        body.conversationId = conversationId;
      }
      testEndpoint('POST', '/api/chat', body, true);
    }

    function testChatHistory() {
      const conversationId = document.getElementById('history-conversation-id').value;
      const limit = document.getElementById('history-limit').value;
      let endpoint = '/api/chat/history';
      const params = [];
      if (conversationId) {
        params.push(`conversationId=${encodeURIComponent(conversationId)}`);
      }
      if (limit) {
        params.push(`limit=${encodeURIComponent(limit)}`);
      }
      if (params.length > 0) {
        endpoint += '?' + params.join('&');
      }
      testEndpoint('GET', endpoint, null, true);
    }

    function testChatConversations() {
      const limit = document.getElementById('conversations-limit').value;
      let endpoint = '/api/chat/conversations';
      if (limit) {
        endpoint += `?limit=${encodeURIComponent(limit)}`;
      }
      testEndpoint('GET', endpoint, null, true);
    }

    function testChatDelete() {
      const conversationId = document.getElementById('delete-conversation-id').value;
      if (!conversationId) {
        alert('Please enter conversation ID');
        return;
      }
      if (!confirm('Are you sure you want to delete this conversation? This action cannot be undone.')) {
        return;
      }
      testEndpoint('DELETE', `/api/chat/conversation/${encodeURIComponent(conversationId)}`, null, true);
    }
  </script>
</body>
</html>
